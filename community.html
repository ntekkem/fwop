<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FWOP - Communities</title>

    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f4f4;
            display: flex;
        }
        .sidebar {
            height: 100vh;
            width: 200px;
            background-color: #176d28;
            color: white;
            padding: 20px;
            position: fixed;
            left: 0;
            top: 0;
            display: flex;
            flex-direction: column;
        }
        .sidebar a {
            color: white;
            text-decoration: none;
            padding: 10px;
            display: block;
            margin: 10px 0;
        }
        .sidebar a:hover {
            background-color: #135622;
            border-radius: 5px;
        }
        .content {
            margin-left: 220px;
            padding: 20px;
            width: 100%;
            text-align: center;
        }
        .container {
            max-width: 600px;
            margin: auto;
            padding: 20px;
            border: 1px solid #176d28;
            border-radius: 5px;
            background: white;
            box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.1);
        }
        .post {
            border: 1px solid #ddd;
            padding: 10px;
            margin-top: 10px;
            border-radius: 5px;
            background: white;
            text-align: left;
        }
        .post .actions {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
        }
        .btn {
            background-color: #176d28;
            color: white;
            border: none;
            padding: 5px 10px;
            cursor: pointer;
            border-radius: 5px;
            margin: 3px;
        }
        .btn:hover {
            background-color: #135622;
        }
        .reaction {
            cursor: pointer;
            font-size: 18px;
            margin-right: 10px;
        }
        .reply-section {
            margin-left: 20px;
            border-left: 2px solid #ddd;
            padding-left: 10px;
        }
    </style>
</head>

<body>

    <!-- Sidebar -->
    <div class="sidebar">
        <h2>Menu</h2>
        <a href="register.html">üìã Register</a>
        <a href="profile.html">üë§ Profile</a>
        <a href="community.html">üåç Communities</a>
        <a href="signup.html">‚úçÔ∏è Volunteer Signup</a>
    </div>

    <!-- Community Page Content -->
    <div class="content">
        <div class="container">
            <h2>Communities</h2>
            <input type="text" id="communityName" placeholder="Create a new community">
            <button class="btn" onclick="createCommunity()">Create</button>

            <h3>Join a Community</h3>
            <select id="communityList"></select>
            <button class="btn" onclick="joinCommunity()">Join</button>

            <h3>Post in <span id="currentCommunity">None</span></h3>
            <textarea id="postContent" placeholder="Write something..."></textarea>
            <input type="file" id="postImage" multiple>
            <button class="btn" onclick="submitPost()">Post</button>

            <h3>Community Feed</h3>
            <div id="feed"></div>
        </div>
    </div>

    <script>
        let communities = JSON.parse(localStorage.getItem("fwop_communities")) || [];
        let currentCommunity = localStorage.getItem("fwop_currentCommunity") || "None";
        document.getElementById("currentCommunity").innerText = currentCommunity;
        
        function createCommunity() {
            let name = document.getElementById("communityName").value.trim();
            if (name === "" || communities.includes(name)) return;
            communities.push(name);
            localStorage.setItem("fwop_communities", JSON.stringify(communities));
            updateCommunityList();
        }

        function updateCommunityList() {
            let list = document.getElementById("communityList");
            list.innerHTML = "";
            communities.forEach(name => {
                let option = document.createElement("option");
                option.value = name;
                option.innerText = name;
                list.appendChild(option);
            });
        }

        function joinCommunity() {
            let name = document.getElementById("communityList").value;
            if (!name) return;
            localStorage.setItem("fwop_currentCommunity", name);
            document.getElementById("currentCommunity").innerText = name;
            loadFeed();
        }

        function submitPost() {
            if (currentCommunity === "None") {
                alert("Please join a community first.");
                return;
            }

            let content = document.getElementById("postContent").value.trim();
            let images = document.getElementById("postImage").files;
            if (content === "" && images.length === 0) return;

            let post = {
                id: Date.now(),
                community: currentCommunity,
                content: content,
                images: [],
                reactions: { up: 0, down: 0 },
                replies: []
            };

            for (let file of images) {
                let reader = new FileReader();
                reader.onload = function (e) {
                    post.images.push(e.target.result);
                    localStorage.setItem("fwop_posts", JSON.stringify(posts));
                    loadFeed();
                };
                reader.readAsDataURL(file);
            }

            let posts = JSON.parse(localStorage.getItem("fwop_posts")) || [];
            posts.push(post);
            localStorage.setItem("fwop_posts", JSON.stringify(posts));
            loadFeed();
        }

        function loadFeed() {
            let feed = document.getElementById("feed");
            feed.innerHTML = "";
            let posts = JSON.parse(localStorage.getItem("fwop_posts")) || [];
            posts.filter(post => post.community === currentCommunity).forEach(post => {
                let postDiv = document.createElement("div");
                postDiv.classList.add("post");
                postDiv.innerHTML = `
                    <p>${post.content}</p>
                    ${post.images.map(img => `<img src="${img}" width="100">`).join("")}
                    <div class="actions">
                        <span class="reaction" onclick="react('${post.id}', 'up')">üëç ${post.reactions.up}</span>
                        <span class="reaction" onclick="react('${post.id}', 'down')">üëé ${post.reactions.down}</span>
                        <button class="btn" onclick="editPost('${post.id}')">Edit</button>
                        <button class="btn" onclick="deletePost('${post.id}')">Delete</button>
                        <button class="btn" onclick="reply('${post.id}')">Reply</button>
                    </div>
                    <div id="replies-${post.id}" class="reply-section">
                        ${post.replies.map(reply => `<p>${reply}</p>`).join("")}
                    </div>
                `;
                feed.appendChild(postDiv);
            });
        }

        function react(postId, type) {
            let posts = JSON.parse(localStorage.getItem("fwop_posts")) || [];
            let post = posts.find(p => p.id == postId);
            post.reactions[type]++;
            localStorage.setItem("fwop_posts", JSON.stringify(posts));
            loadFeed();
        }

        function editPost(postId) {
            let posts = JSON.parse(localStorage.getItem("fwop_posts")) || [];
            let post = posts.find(p => p.id == postId);
            let newText = prompt("Edit your post:", post.content);
            if (newText) {
                post.content = newText;
                localStorage.setItem("fwop_posts", JSON.stringify(posts));
                loadFeed();
            }
        }

        function deletePost(postId) {
            let posts = JSON.parse(localStorage.getItem("fwop_posts")) || [];
            posts = posts.filter(p => p.id != postId);
            localStorage.setItem("fwop_posts", JSON.stringify(posts));
            loadFeed();
        }

        function reply(postId) {
            let replyText = prompt("Write a reply:");
            if (!replyText) return;
            let posts = JSON.parse(localStorage.getItem("fwop_posts")) || [];
            let post = posts.find(p => p.id == postId);
            post.replies.push(replyText);
            localStorage.setItem("fwop_posts", JSON.stringify(posts));
            loadFeed();
        }

        updateCommunityList();
        loadFeed();
    </script>

</body>
</html>
